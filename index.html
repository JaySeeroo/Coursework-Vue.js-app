<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
  <link rel="stylesheet" href="styles.css">
  <title>Lessons App</title>
</head>
<body>
  <div id="webstore">
    <header>
      <h1>{{ message }}</h1>
      <button 
        v-on:click="showCheckOut" 
        :disabled="showProduct && cart.length === 0" 
        class="cart-toggle-btn"
      >
        <span class="fa-solid fa-cart-shopping"></span>
        <span class="cart-count">{{ itemInCart }}</span>
        <span class="btn-text">{{ showProduct ? 'View Cart' : 'Back to Lessons' }}</span>
      </button>
    </header>

    <main>
      <div v-if="showProduct">
        <div class="sort-controls">
          <label for="sortAttribute">Sort by:</label>
          <select v-model="sortAttribute" id="sortAttribute">
            <option value="subject">Subject</option>
            <option value="location">Location</option>
            <option value="price">Price</option>
            <option value="spaces">Spaces</option>
          </select>

          <label for="sortOrder">Order:</label>
          <select v-model="sortOrder" id="sortOrder">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
          </select>
        </div>

        <div v-for="lesson in sortedLessons" :key="lesson.id" class="lesson-card">
          <i :class="lesson.icon"></i>
          <h2>{{ lesson.subject }}</h2>
          <p><strong>Location:</strong> {{ lesson.location }}</p>
          <p><strong>Price:</strong> ${{ lesson.price }}</p>
          <p><strong>Spaces Left:</strong> {{ itemsLeft(lesson) }}</p>

          <button v-on:click="addToCart(lesson)" v-if="canAddToCart(lesson)">Add to Cart</button>
          <button disabled v-else>Add to Cart</button>

          <span v-if="itemsLeft(lesson) === 0">All out!</span>
          <span v-else-if="itemsLeft(lesson) < 5">Only {{ itemsLeft(lesson) }} left!</span>
          <span v-else>Buy now!</span>
        </div>
      </div>

      <div v-else class="cart-page">
        <h2>Your Shopping Cart</h2>

        <div v-if="orderSubmitted">
          <p class="confirmation">âœ… Your order has been submitted successfully!</p>
        </div>

        <div v-else>
          <div v-if="cart.length > 0">
            <div v-for="lesson in cartLessons" :key="lesson.id" class="lesson-card">
              <i :class="lesson.icon"></i>
              <h2>{{ lesson.subject }}</h2>
              <p><strong>Location:</strong> {{ lesson.location }}</p>
              <p><strong>Price:</strong> ${{ lesson.price }}</p>
              <p>Quantity: {{ cartCount(lesson.id) }}</p>
              <button v-on:click="removeFromCart(lesson)">Remove One</button>
            </div>
            <div class="cart-summary">
              <p>Total Items: {{ itemInCart }}</p>
              <p>Total Price: ${{ totalPrice }}</p>
            </div>

            <div class="checkout-form">
              <h3>Checkout</h3>
              <p>
                <label for="name">Name:</label>
                <input id="name" v-model="order.name" placeholder="Enter your name">
              </p>
              <p>
                <label for="phone">Phone:</label>
                <input id="phone" v-model="order.phone" placeholder="Enter your phone">
              </p>
              <button 
                @click="submitOrder" 
                :disabled="!isValidName || !isValidPhone"
              >
                Checkout
              </button>
            </div>
          </div>
          <div v-else>
            <p>Your cart is empty.</p>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    let webstore = new Vue({
      el: '#webstore',
      data: {
        message: 'Welcome to the Lessons Store!',
        showProduct: true,
        sortAttribute: 'subject',
        sortOrder: 'asc',
        cart: [],
        order: {
          name: '',
          phone: ''
        },
        orderSubmitted: false,
        lessons: [
          { id: 1, subject: "Math", location: "London", price: 50, spaces: 5, icon: "fas fa-square-root-alt" },
          { id: 2, subject: "English", location: "Manchester", price: 40, spaces: 5, icon: "fas fa-book" },
          { id: 3, subject: "Science", location: "Birmingham", price: 60, spaces: 5, icon: "fas fa-flask" },
          { id: 4, subject: "History", location: "Liverpool", price: 45, spaces: 5, icon: "fas fa-landmark" },
          { id: 5, subject: "Geography", location: "Leeds", price: 55, spaces: 5, icon: "fas fa-globe" },
          { id: 6, subject: "Art", location: "Bristol", price: 35, spaces: 5, icon: "fas fa-paint-brush" },
          { id: 7, subject: "Music", location: "Oxford", price: 50, spaces: 5, icon: "fas fa-music" },
          { id: 8, subject: "Programming", location: "Cambridge", price: 70, spaces: 5, icon: "fas fa-laptop-code" },
          { id: 9, subject: "Drama", location: "Brighton", price: 40, spaces: 5, icon: "fas fa-theater-masks" },
          { id: 10, subject: "Sports", location: "Newcastle", price: 30, spaces: 5, icon: "fas fa-football-ball" },
          { id: 11, subject: "Biology", location: "Sheffield", price: 65, spaces: 5, icon: "fas fa-dna" },
          { id: 12, subject: "Computer Graphics", location: "Nottingham", price: 75, spaces: 5, icon: "fas fa-desktop" }
        ]
      },
      methods: {
        addToCart(lesson) {
          if (this.canAddToCart(lesson)) {
            this.cart.push(lesson.id);
          }
        },
        removeFromCart(lesson) {
          const index = this.cart.indexOf(lesson.id);
          if (index > -1) {
            this.cart.splice(index, 1);
          }
        },
        canAddToCart(lesson) {
          return lesson.spaces > this.cartCount(lesson.id);
        },
        cartCount(lessonId) {
          return this.cart.filter(id => id === lessonId).length;
        },
        itemsLeft(lesson) {
          return lesson.spaces - this.cartCount(lesson.id);
        },
        showCheckOut() {
          this.showProduct = !this.showProduct;
        },
        submitOrder() {
          if (this.isValidName && this.isValidPhone) {
            this.orderSubmitted = true;
            this.cart = [];
            this.order.name = '';
            this.order.phone = '';
          }
        }
      },
      computed: {
        itemInCart() {
          return this.cart.length || 0;
        },
        sortedLessons() {
          return this.lessons.slice().sort((a, b) => {
            let modifier = this.sortOrder === 'asc' ? 1 : -1;

            if (this.sortAttribute === 'spaces') {
              let aSpaces = this.itemsLeft(a);
              let bSpaces = this.itemsLeft(b);
              if (aSpaces < bSpaces) return -1 * modifier;
              if (aSpaces > bSpaces) return 1 * modifier;
              return 0;
            }

            if (a[this.sortAttribute] < b[this.sortAttribute]) return -1 * modifier;
            if (a[this.sortAttribute] > b[this.sortAttribute]) return 1 * modifier;
            return 0;
          });
        },
        cartLessons() {
          return this.lessons.filter(lesson => this.cart.includes(lesson.id));
        },
        totalPrice() {
          return this.cart.reduce((sum, id) => {
            const lesson = this.lessons.find(l => l.id === id);
            return sum + (lesson ? lesson.price : 0);
          }, 0);
        },
        isValidName() {
          return /^[A-Za-z\s]+$/.test(this.order.name.trim());
        },
        isValidPhone() {
          return /^[0-9]+$/.test(this.order.phone.trim());
        }
      }
    });
  </script>
</body>
</html>
